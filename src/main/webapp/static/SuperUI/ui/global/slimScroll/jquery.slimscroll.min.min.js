/*! Copyright (c) 2011 Piotr Rochala (http://rocha.la)
 * Dual licensed under the MIT (http://www.opensource.org/licenses/mit-license.php)
 * and GPL (http://www.opensource.org/licenses/gpl-license.php) licenses.
 *
 * Version: 1.3.8
 *
 */
(function(b){b.fn.extend({slimScroll:function(a){var f={width:"auto",height:"250px",size:"7px",color:"#000",position:"right",distance:"1px",start:"top",opacity:0.4,alwaysVisible:false,disableFadeOut:false,railVisible:false,railColor:"#333",railOpacity:0.2,railDraggable:true,railClass:"slimScrollRail",barClass:"slimScrollBar",wrapperClass:"slimScrollDiv",allowPageScroll:false,wheelStep:20,touchScrollStep:200,borderRadius:"7px",railBorderRadius:"7px"};var e=b.extend(f,a);this.each(function(){var c,J,U,O,L,H,Q,V,T="<div></div>",F=30,M=false;var K=b(this);if(K.parent().hasClass(e.wrapperClass)){var X=K.scrollTop();h=K.siblings("."+e.barClass);aa=K.siblings("."+e.railClass);I();if(b.isPlainObject(a)){if("height" in a&&a.height=="auto"){K.parent().css("height","auto");K.css("height","auto");var R=K.parent().parent().height();K.parent().css("height",R);K.css("height",R)}else{if("height" in a){var G=a.height;K.parent().css("height",G);K.css("height",G)}}if("scrollTo" in a){X=parseInt(e.scrollTo)}else{if("scrollBy" in a){X+=parseInt(e.scrollBy)}else{if("destroy" in a){h.remove();aa.remove();K.unwrap();return}}}d(X,false,true)}return}else{if(b.isPlainObject(a)){if("destroy" in a){return}}}e.height=(e.height=="auto")?K.parent().height():e.height;var W=b(T).addClass(e.wrapperClass).css({position:"relative",overflow:"hidden",width:e.width,height:e.height});K.css({overflow:"hidden",width:e.width,height:e.height});var aa=b(T).addClass(e.railClass).css({width:e.size,height:"100%",position:"absolute",top:0,display:(e.alwaysVisible&&e.railVisible)?"block":"none","border-radius":e.railBorderRadius,background:e.railColor,opacity:e.railOpacity,zIndex:90});var h=b(T).addClass(e.barClass).css({background:e.color,width:e.size,position:"absolute",top:0,opacity:e.opacity,display:e.alwaysVisible?"block":"none","border-radius":e.borderRadius,BorderRadius:e.borderRadius,MozBorderRadius:e.borderRadius,WebkitBorderRadius:e.borderRadius,zIndex:99});var Z=(e.position=="right")?{right:e.distance}:{left:e.distance};aa.css(Z);h.css(Z);K.wrap(W);K.parent().append(h);K.parent().append(aa);if(e.railDraggable){h.bind("mousedown",function(g){var i=b(document);U=true;t=parseFloat(h.css("top"));pageY=g.pageY;i.bind("mousemove.slimscroll",function(j){currTop=t+j.pageY-pageY;h.css("top",currTop);d(0,h.position().top,false)});i.bind("mouseup.slimscroll",function(j){U=false;S();i.unbind(".slimscroll")});return false}).bind("selectstart.slimscroll",function(g){g.stopPropagation();g.preventDefault();return false})}aa.hover(function(){Y()},function(){S()});h.hover(function(){J=true},function(){J=false});K.hover(function(){c=true;Y();S()},function(){c=false;S()});K.bind("touchstart",function(i,g){if(i.originalEvent.touches.length){L=i.originalEvent.touches[0].pageY}});K.bind("touchmove",function(i){if(!M){i.originalEvent.preventDefault()}if(i.originalEvent.touches.length){var g=(L-i.originalEvent.touches[0].pageY)/e.touchScrollStep;d(g,true);L=i.originalEvent.touches[0].pageY}});I();if(e.start==="bottom"){h.css({top:K.outerHeight()-h.outerHeight()});d(0,true)}else{if(e.start!=="top"){d(b(e.start).position().top,null,true);if(!e.alwaysVisible){h.hide()}}}P(this);function N(j){if(!c){return}var j=j||window.event;var i=0;if(j.wheelDelta){i=-j.wheelDelta/120}if(j.detail){i=j.detail/3}var g=j.target||j.srcTarget||j.srcElement;if(b(g).closest("."+e.wrapperClass).is(K.parent())){d(i,true)}if(j.preventDefault&&!M){j.preventDefault()}if(!M){j.returnValue=false}}function d(g,l,k){M=false;var i=g;var j=K.outerHeight()-h.outerHeight();if(l){i=parseInt(h.css("top"))+g*parseInt(e.wheelStep)/100*h.outerHeight();i=Math.min(Math.max(i,0),j);i=(g>0)?Math.ceil(i):Math.floor(i);h.css({top:i+"px"})}Q=parseInt(h.css("top"))/(K.outerHeight()-h.outerHeight());i=Q*(K[0].scrollHeight-K.outerHeight());if(k){i=g;var m=i/K[0].scrollHeight*K.outerHeight();m=Math.min(Math.max(m,0),j);h.css({top:m+"px"})}K.scrollTop(i);K.trigger("slimscrolling",~~i);Y();S()}function P(g){if(window.addEventListener){g.addEventListener("DOMMouseScroll",N,false);g.addEventListener("mousewheel",N,false)}else{document.attachEvent("onmousewheel",N)}}function I(){H=Math.max((K.outerHeight()/K[0].scrollHeight)*K.outerHeight(),F);h.css({height:H+"px"});var g=H==K.outerHeight()?"none":"block";h.css({display:g})}function Y(){I();clearTimeout(O);if(Q==~~Q){M=e.allowPageScroll;if(V!=Q){var g=(~~Q==0)?"top":"bottom";K.trigger("slimscroll",g)}}else{M=false}V=Q;if(H>=K.outerHeight()){M=true;return}h.stop(true,true).fadeIn("fast");if(e.railVisible){aa.stop(true,true).fadeIn("fast")}}function S(){if(!e.alwaysVisible){O=setTimeout(function(){if(!(e.disableFadeOut&&c)&&!J&&!U){h.fadeOut("slow");aa.fadeOut("slow")}},1000)}}});return this}});b.fn.extend({slimscroll:b.fn.slimScroll})})(jQuery);